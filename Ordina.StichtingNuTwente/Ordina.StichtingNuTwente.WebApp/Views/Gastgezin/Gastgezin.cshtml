@using Ordina.StichtingNuTwente.Models.ViewModels
@using Ordina.StichtingNuTwente.Models.Models
@model GastgezinViewModel
@inject Microsoft.AspNetCore.Http.IHttpContextAccessor Accessor

@{
    ViewData["Title"] = "Gastgezin " + Model.GastGezin.Naam;
}

<div class="row">
    <div class="col" id="TitleCol">
        <div class="card border-0 bg-transparent shadow-none" id="TitleCard">
            <div class="card-body">
                <h2 class="card-title">
                    Gastgezin @Model.GastGezin.Naam
                    @if (Model.GastGezin.Status == GastgezinStatus.OnHold)
                    {
                        <span class="badge bg-secondary">On Hold</span>
                    }
                </h2>
            </div>
        </div>
    </div>
    @if (User.HasClaims("groups", "group-superadmin"))
    {
        <div class="col col-1">
            <div class="card border-0 bg-transparent shadow-none">
                <div class=card-body>
                    <button id="deleteGastgezin" class="btn btn-danger">Delete</button>
                </div>
            </div>
        </div>
        <script>
            $("#deleteGastgezin").on("click", function (){
               let id = @Model.GastGezin.Id;
               if (confirm("Weet je zeker dat je dit gastgezin wilt verwijderen? De formulieren blijven bestaan")) {
                 $.ajax({
                       url: "/Gastgezin/DeleteGastgezin/" + id,
                       type: "DELETE",
                       dataType: 'text',
                       success: function(){
                           if(window.location.href != document.referrer){
                               window.location = document.referrer;
                           }else{
                               window.location = "/";
                           }
                       },
                       error: function() {
                           window.location = "/Error";
                       }
                   });
               }
             })
        </script>
    }
</div>
<div class="row">
    <div class="col-3" id="ContactInfoCol">
        <div class="card" id="ContactInfoCard">
            <div class="card-body">

                <h5 class="card-title">Contact Informatie</h5>
                <p>
                    Naam: @Model.GastGezin.Naam</br>
                    Telefoonnummer: @Model.GastGezin.Telefoonnummer</br>
                    Email: @Model.GastGezin.Email
                </p>
                <h5>Adres</h5>
                <p>
                    Straat: @Model.GastGezin.Adres</br>
                    Woonplaats: @Model.GastGezin.Woonplaats</br>
                    Postcode: 1111AA
                </p>
                <h5>Formulieren</h5>
                <a href="getnutwenteoverheidreactiesdetail25685niveau?id=@Model.GastGezin.AanmeldFormulierId" class="link">Aanmeldformulier</a>
                </br>
                @if (Model.GastGezin.IntakeFormulierId != 0)
                {
                    <a href="/getnutwenteoverheidreactiesdetail25685niveau?id=@Model.GastGezin.IntakeFormulierId" class="link">Intakeformulier</a>
                }
                else
                {
                    <a href="/GastgezinIntake?gastgezinId=@Model.GastGezin.Id" class="btn btn-primary mt-3">Begin Intake</a>
                }
                </br>
                <h5 class="mt-3">Opties</h5>
                @using (Html.BeginForm("UpdateOpties", "Gastgezin", FormMethod.Post))
                {
                    <input type="hidden" name="GastGezinId" value="@Model.GastGezin.Id">
                    <div class="row mt-1">
                        <label class="col-3">Status:</label>
                        <div class="col">
                            <select name="Status" id="status" class="form-select">
                                @foreach (var option in Enum.GetValues(typeof(GastgezinStatus)))
                                {

                                    if ((GastgezinStatus)option == Model.GastGezin.Status)
                                    {
                                        <option selected value="@option">@option</option>
                                    }
                                    else
                                    {
                                        <option value="@option">@option</option>
                                    }
                                }
                            </select>
                        </div>
                    </div>
                    <div class="row mt-1">
                        <label class="col-3">VOG:</label>
                        <div class="col">
                            <input type="checkbox" class="form-check-input" id="HasVOG" name="HasVOG" value="true" @((Model.GastGezin.HasVOG != null && Model.GastGezin.HasVOG == true)?"checked":"")>
                        </div>
                    </div>

                    <h5 class="mt-3">Maximale Capaciteit</h5>

                    <div class="row mt-1 justify-content-between">
                        <label class="col-5">Volwassenen:</label>
                        <div class="col-4">
                            <input type="number" class="form-control" name="MaxAdults" value="@Model.GastGezin.MaxAdults">
                        </div>
                    </div>
                    <div class="row mt-1 justify-content-between">
                        <label class="col-5">Kinderen:</label>
                        <div class="col-4">
                            <input type="number" class="form-control" name="MaxChildren" value="@Model.GastGezin.MaxChildren">
                        </div>
                    </div>
                    <input type="submit" class="btn btn-primary mt-3" value=Opslaan>
                }
            </div>
        </div>
    </div>
    <div class="col-9">
        <div class="row">
            <div class="col" id="DetailsCol">
                <div class="card" id="DetailsCard">
                    <div class="card-body">
                        <h5 class="card-title bg-white">Details</h5>
                        <div class="row row-cols-2">
                            <div class="col"><b>Alchohol&drugs:</b> @Model.GastGezin.PlaatsingsInfo.AlchoholEnDrugs</div>
                            <div class="col"><b>Allergien:</b> @Model.GastGezin.PlaatsingsInfo.Allergieen</div>
                            <div class="col"><b>Basisscholen:</b> @Model.GastGezin.PlaatsingsInfo.BasisscholenAanwezig</div>
                            <div class="col"><b>Belemmeringen:</b> @Model.GastGezin.PlaatsingsInfo.Belemmering</div>
                            <div class="col"><b>Beperkingen:</b> @Model.GastGezin.PlaatsingsInfo.Beperkingen</div>
                            <div class="col"><b>Daglicht slaapkamer:</b> @Model.GastGezin.PlaatsingsInfo.DaglichtSlaapkamer</div>
                            <div class="col"><b>Faciliteiten:</b> @Model.GastGezin.PlaatsingsInfo.Faciliteiten</div>
                            <div class="col"><b>Faciliteiten kinderen:</b> @Model.GastGezin.PlaatsingsInfo.FaciliteitenVoorKinderen</div>
                            <div class="col"><b>Huisderen aanwezig:</b> @Model.GastGezin.PlaatsingsInfo.HuisdierenAanwezig</div>
                            <div class="col"><b>Huisderen mogelijk:</b> @Model.GastGezin.PlaatsingsInfo.HuisdierenMogelijk</div>
                            <div class="col"><b>Kinderen in de buurt:</b> @Model.GastGezin.PlaatsingsInfo.KinderenInDeBuurt</div>
                            <div class="col"><b>Kleine kinderen:</b> @Model.GastGezin.PlaatsingsInfo.KleineKinderen</div>
                            <div class="col"><b>Koelkast:</b> @Model.GastGezin.PlaatsingsInfo.KoelkastRuimte</div>
                            <div class="col"><b>Opbergruimte:</b> @Model.GastGezin.PlaatsingsInfo.Opbergruimte</div>
                            <div class="col"><b>Privacy:</b> @Model.GastGezin.PlaatsingsInfo.Privacy</div>
                            <div class="col"><b>Roken:</b> @Model.GastGezin.PlaatsingsInfo.Roken</div>
                            <div class="col"><b>Slaapkamer ruimte:</b> @Model.GastGezin.PlaatsingsInfo.SlaapkamerRuimte</div>
                            <div class="col"><b>Privacy:</b> @Model.GastGezin.PlaatsingsInfo.VeiligeOpbergruimte</div>
                            <div class="col"><b>Vluchteling ophalen:</b> @Model.GastGezin.PlaatsingsInfo.VluchtelingOphalen</div>
                            <div class="col"><b>Volwassenen en grotere kinderen:</b> @Model.GastGezin.PlaatsingsInfo.VolwassenenGrotereKinderen </div>
                            <div class="col"><b>Zelf koken:</b> @Model.GastGezin.PlaatsingsInfo.ZelfKoken </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col g-4" id="NotitiesCol">
                <div class="card" id="NotitiesCard">
                    <div class="card-body">
                        <h5 class="card-title">Notities</h5>
                        @using (Html.BeginForm("PostNote", "Gastgezin", FormMethod.Post))
                        {
                            <input type="hidden" name="GastGezinId" value="@Model.GastGezin.Id">
                            <div class="grow-wrap">
                                <textarea id="Id" rows="3" class="form-control question" name="Note" onInput="this.parentNode.dataset.replicatedValue = this.value" onclick="this.parentNode.dataset.replicatedValue = this.value">@Model.GastGezin.Note</textarea>
                            </div>
                            <input type="submit" class="btn btn-primary mt-3" value="Opslaan">
                        }
                    </div>
                </div>
            </div>
            <div class="col-5 g-4" id="NieuwePlaatsingCol">
                <div class="card" id="NieuwePlaatsingCard">
                    <div class="card-body">
                        <h5 class="card-title">Nieuwe Plaatsing</h5>
                        @using (Html.BeginForm("PostPlaatsing", "Gastgezin", FormMethod.Post))
                        {
                            <input type="hidden" name="GastGezinId" value="@Model.GastGezin.Id">
                            <div class="row justify-content-sm-left">
                                <label for="colFormLabelSm" class="col col-form-label">Type</label>
                                <div class="col">
                                    <select name="PlacementType" id="PlacementType" class="form-select">
                                        <option value="@PlacementType.Plaatsing">@PlacementType.Plaatsing</option>
                                        <option value="@PlacementType.Reservering">@PlacementType.Reservering</option>
                                    </select>
                                </div>
                            </div>
                            <div class="row justify-content-sm-left">
                                <label for="colFormLabelSm" class="col col-form-label">Leeftijd</label>
                                <div class="col">
                                    <input type="number" class="form-control form-control" id="colFormLabelSm" name="Age" value="0">
                                </div>
                            </div>
                            <div class="row justify-content-sm-left">
                                <label for="colFormLabelSm" class="col col-form-label">Gender</label>
                                <div class="col">
                                    <select name="Gender" id="Gender" class="form-select">
                                        @foreach (var option in Enum.GetValues(typeof(Gender)))
                                        {
                                            <option value="@option">@option</option>
                                        }
                                    </select>
                                </div>
                            </div>
                            <div class="row justify-content-sm-left">
                                <label for="colFormLabelSm" class="col col-form-label">Datum</label>
                                <div class="col">
                                    <input type="date" class="form-control" id="colFormLabelSm" name="Date" value="@DateTime.Now.ToString("yyyy-MM-dd")">
                                </div>
                            </div>
                            <div class="card-buttons mt-3">
                                <input type="submit" value="Plaats" class="btn btn-primary">
                            </div>
                        }
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="row">
</div>

<div class="row">
    <div class="col g-4">
        <div class="card">
            <div class="card-body">
                <h5 class="card-title">Plaatsingen (@Model.Plaatsingen.Count/@(Model.GastGezin.MaxAdults+Model.GastGezin.MaxChildren))</h5>
                @foreach (var p in Model.Plaatsingen)
                {
                    <div class="card">
                        <div class="card-body">

                            <div class="row">
                                <div class=col>
                                    <p>@p.DateTime.ToShortDateString()</p>
                                </div>
                                <div class=col>
                                    <p>@p.Gender</p>
                                </div>
                                <div class=col>
                                    <p>@p.Age jaar</p>
                                </div>
                                <div class=col>
                                    <a type="button" class="btn-close float-right" aria-label="Close" href="/DeletePlaatsing?PlaatsingId=@p.Id" title="Verwijder Plaatsing"></a>
                                </div>
                            </div>
                        </div>
                    </div>
                }
            </div>
        </div>
    </div>
    <div class="col g-4">
        <div class="card">
            <div class="card-body">
                <h5 class="card-title">Reserveringen (@Model.Reserveringen.Count/@(Model.GastGezin.MaxAdults+Model.GastGezin.MaxChildren))</h5>
                @foreach (var p in Model.Reserveringen)
                {
                    <div class="card">
                        <div class="card-body">
                            <div class="row">
                                <div class=col>
                                    <a type="button" href="/PlaatsReservering?PlaatsingId=@p.Id" title="Plaats reservering">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-left" viewBox="0 0 16 16">
                                            <path fill-rule="evenodd" d="M6 12.5a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-9a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v2a.5.5 0 0 1-1 0v-2A1.5 1.5 0 0 1 6.5 2h8A1.5 1.5 0 0 1 16 3.5v9a1.5 1.5 0 0 1-1.5 1.5h-8A1.5 1.5 0 0 1 5 12.5v-2a.5.5 0 0 1 1 0v2z" />
                                            <path fill-rule="evenodd" d="M.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L1.707 7.5H10.5a.5.5 0 0 1 0 1H1.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z" />
                                        </svg>
                                        </a>
                                </div>
                                <div class=col>
                                    <p>@p.DateTime.ToShortDateString()</p>
                                </div>
                                <div class=col>
                                   <p>@p.Gender</p>
                                </div>
                                <div class=col>
                                    <p>@p.Age jaar</p>
                                </div>
                                <div class=col>
                                    <a type="button" class="btn-close float-right" aria-label="Close" href="/DeletePlaatsing?PlaatsingId=@p.Id" title="Verwijder reservering"></a>
                                </div>
                            </div>
                        </div>
                    </div>
                }
            </div>
        </div>
    </div>
</div>


<div class="row">
    <div class="col g-4">
        <div class="card">
            <div class="card-body">
                <h5 class="card-title">Plaatsingsgeschiedenis</h5>
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th scope="col">Datum</th>
                            <th scope="col">Type</th>
                            <th scope="col">Aantal mensen</th>
                            <th scope="col">Gender</th>
                            <th scope="col">Leeftijdsgroep</th>
                            <th scope="col">Leeftijd</th>
                            <th scope="col">Uitgevoerd door</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var plaatsing in Model.PlaatsingsGeschiedenis)
                        {
                            <tr>
                                <td>@plaatsing.DateTime</td>
                                <td>@plaatsing.PlacementType</td>
                                <td>@plaatsing.Amount</td>
                                <td>@plaatsing.Gender</td>
                                <td>@plaatsing.AgeGroup</td>
                                <td>@plaatsing.Age</td>
                                <td>@plaatsing.Vrijwilliger.FirstName @plaatsing.Vrijwilliger.LastName (@plaatsing.Vrijwilliger.Email)</td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", function (event) {
        var scrollpos = sessionStorage.getItem('scrollpos');
        if (scrollpos) {
            window.scrollTo(0, scrollpos);
            sessionStorage.removeItem('scrollpos');
        }
    });

    window.addEventListener("beforeunload", function (e) {
        sessionStorage.setItem('scrollpos', window.scrollY);
    });
</script>